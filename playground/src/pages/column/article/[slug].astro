---
import StarlightPage from "@/components/StarlightPage.astro";
import { getArticle } from "@/scripts/api";
import { marked } from "marked";

const { slug } = Astro.params;

// console.time("getArticle ExecutionTime");
const { articles } = await getArticle(slug);
// console.timeEnd("getArticle ExecutionTime");
if (!articles || articles.length !== 1) {
  return context.redirect("/404");
}

let article = articles[0].flatData;
if (article.content) {
  article = {
    ...article,
    content: await marked.parse(article.content),
  };
}

const frontmatter = { title: article.name ?? "Untitled" };
---

<StarlightPage {frontmatter}>
  <Fragment set:html={article.content}>
</StarlightPage>
