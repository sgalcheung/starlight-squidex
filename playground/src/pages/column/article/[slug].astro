---
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import { Markdown } from "astro-remote";
import { extractHeadings } from "@/helpers/markdown";
import Heading from "@/components/Heading.astro";
import { getArticle } from "@/scripts/api";

const { slug } = Astro.params;

console.time("getArticle ExecutionTime");
const { articles } = await getArticle(slug);
console.timeEnd("getArticle ExecutionTime");
if (!articles || articles.length !== 1) {
  return Astro.redirect("/404");
}

const article = articles[0].flatData;

const frontmatter = { title: article.name ?? "" };

const headings = extractHeadings(article.content as string);
---

<StarlightPage {frontmatter} {headings}>
  {
    article.content && article.content.length > 0 && (
      <Markdown
        content={article.content}
        sanitize={{ allowComponents: true }}
        components={{ Heading }}
      />
    )
  }
</StarlightPage>
