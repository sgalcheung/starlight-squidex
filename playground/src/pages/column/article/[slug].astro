---
import StarlightPage from "@/overrides/StarlightPage.astro";
import { getArticle } from "@/scripts/api";
import { Markdown } from "astro-remote";
import { extractHeadings } from "@/helpers/markdown";

const { slug } = Astro.params;

// console.time("getArticle ExecutionTime");
const { articles } = await getArticle(slug);
// console.timeEnd("getArticle ExecutionTime");
if (!articles || articles.length !== 1) {
  return context.redirect("/404");
}

const article = articles[0].flatData;

const frontmatter = { title: article.name ?? "Untitled" };

const headings = extractHeadings(article.content as string);
---

<StarlightPage {frontmatter} {headings}>
  <Markdown content={article.content ?? ""} />
</StarlightPage>
